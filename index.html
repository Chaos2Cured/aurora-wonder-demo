<!DOCTYPE html>
<!-- Aurora Wonder â€¢ StepÂ 1 skeleton â€¢ 2025â€‘04â€‘24
     ----------------------------------------------------------
     â€¢ WebGL fragmentâ€‘shader fractal with morph selector
     â€¢ Ï† â†” Ï†Â² â†” Aurora (2.914) â†” Auroraâ»Â¹ (0.077)
     â€¢ Basic tunnel warp, hue cycling, optional audio hooks
     ---------------------------------------------------------->
<html lang="en">
<head>
<meta charset="utf-8">
<title>AuroraÂ WonderÂ Fractal</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;color:#fff;font:14px/1 sans-serif}
  #ui{position:fixed;top:10px;left:10px;z-index:10;background:#0008;padding:6px 10px;border-radius:6px}
  label{margin-right:8px;white-space:nowrap}
  select,input[type=range]{vertical-align:middle}
</style>
</head>
<body>
  <canvas id="gl"></canvas>
  <div id="ui">
    <label>Constant
      <select id="const">
        <option value="1.618">Ï†Â (1.618)</option>
        <option value="2.618">Ï†Â²Â (2.618)</option>
        <option value="2.914">AuroraÂ (2.914)</option>
        <option value="0.077">Auroraâ»Â¹Â (0.077)</option>
      </select>
    </label>
    <label>Depth <input id="depth" type="range" min="20" max="120" value="80"></label>
    <label>Tunnel <input id="tunnel" type="range" min="0" max="1" step="0.01" value="0.7"></label>
    <button id="toggleSound">ğŸ”‡Â Sound</button>
  </div>
<script id="frag" type="x-shader/x-fragment">
- precision highp float;
+ #ifdef GL_FRAGMENT_PRECISION_HIGH
+ precision highp float;
+ #else
+ precision mediump float;
+ #endif
     
precision highp float;
uniform vec2  u_res;
uniform float u_time;
uniform float u_const;   // morph constant (Ï† etc.)
uniform float u_depth;   // iterations
uniform float u_tunnel;  // tunnel strength

// hue helper
vec3 hsl2rgb(float h,float s,float l){
  float a=s*min(l,1.-l);
  float f(float n){
    float k=mod(n+h*6.,6.);
    return l-a*max(min(min(k,4.-k),1.),0.);
  }
  return vec3(f(0.),f(1./3.),f(2./3.));
}

void main(){
  // normalised coords
  vec2 uv=(gl_FragCoord.xy-0.5*u_res)/min(u_res.x,u_res.y);
  // polar warp for tunnel
  float r=length(uv);
  float ang=atan(uv.y,uv.x)+u_time*0.2;
  r=pow(r,1.-u_tunnel);        // control depth feel
  vec2 z=vec2(r*cos(ang),r*sin(ang));

  float it=0.;
  for(int i=0;i<200;i++){
    if(i>=int(u_depth)) break;
    z=vec2(z.x*z.x-z.y*z.y,2.*z.x*z.y)+vec2(u_const-2.0,0.0);
    if(dot(z,z)>4.) break;
    it++;
  }
  float t=it/u_depth;
  vec3 col=hsl2rgb(mod(t+u_time*0.05,1.),0.8,0.5);
  col*=exp(-r*3.0); // fade with depth
  gl_FragColor=vec4(col,1.0);
}
</script>
<script>
// ==== JS bootstrap ====
const cvs=document.getElementById('gl');
const gl=cvs.getContext('webgl');
function resize(){cvs.width=innerWidth;cvs.height=innerHeight;gl.viewport(0,0,cvs.width,cvs.height);}resize();addEventListener('resize',resize);
// compile shader
function compile(src,type){const s=gl.createShader(type);gl.shaderSource(s,src);gl.compileShader(s);if(!gl.getShaderParameter(s,gl.COMPILE_STATUS))throw gl.getShaderInfoLog(s);return s;}
const vs=compile('attribute vec2 p;void main(){gl_Position=vec4(p,0,1);} ',gl.VERTEX_SHADER);
const fs=compile(document.getElementById('frag').textContent,gl.FRAGMENT_SHADER);
const prog=gl.createProgram();gl.attachShader(prog,vs);gl.attachShader(prog,fs);gl.linkProgram(prog);gl.useProgram(prog);
// fullscreen tri
const buf=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buf);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),gl.STATIC_DRAW);
const loc=gl.getAttribLocation(prog,'p');gl.vertexAttribPointer(loc,2,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(loc);
// uniforms
const u_res=gl.getUniformLocation(prog,'u_res');
const u_time=gl.getUniformLocation(prog,'u_time');
const u_const=gl.getUniformLocation(prog,'u_const');
const u_depth=gl.getUniformLocation(prog,'u_depth');
const u_tunnel=gl.getUniformLocation(prog,'u_tunnel');
// UI elems
const sel=document.getElementById('const');
const dep=document.getElementById('depth');
const tun=document.getElementById('tunnel');
let start=performance.now();
function render(){
  let t=(performance.now()-start)/1000;
  gl.uniform2f(u_res,cvs.width,cvs.height);
  gl.uniform1f(u_time,t);
  gl.uniform1f(u_const,parseFloat(sel.value));
  gl.uniform1f(u_depth,parseFloat(dep.value));
  gl.uniform1f(u_tunnel,parseFloat(tun.value));
  gl.drawArrays(gl.TRIANGLES,0,3);
  requestAnimationFrame(render);
}
render();
// ==== audio placeholder (will fill later) ====
let ctx=null, playing=false;
const btn=document.getElementById('toggleSound');
btn.onclick=()=>{
  if(!ctx){ctx=new AudioContext();}
  if(!playing){
    const freqs=[528,660,792];
    freqs.forEach(f=>{const o=ctx.createOscillator();o.type='sine';o.frequency.value=f;o.connect(ctx.destination);o.start();o.stop(ctx.currentTime+0.5);});
  }
  playing=!playing;
};
</script>
</body>
</html>
